env:
    CIRRUS_CLONE_DEPTH: 1
    BUILD_HOSTNAME: "cirrus-ci.org"
    rom_name: Nusantara
    device: lavender
    
task:
  name: "Snx-S"
  timeout_in: 4h
  container:
      image: snaxpsycho/snaxpsycho:test
      cpu: 4
      memory: 16G
      stateful: true
      greedy: true
      volumes:
          - /home/cirrus:/home/cirrus
          - /home/cirrus/ccache:/home/cirrus/ccache
          - /home/cirrus/.config:/home/cirrus/.config
          
  runner_script:
    - curl -L -o cirrus https://github.com/cirruslabs/cirrus-cli/releases/latest/download/cirrus-linux-amd64
    - sudo mv cirrus /usr/local/bin/cirrus
    - sudo chmod +x /usr/local/bin/cirrus      
    - sudo cirrus worker run --token 2t1jl7pe3jpcfioqs9hb6cds1emcmdmlrhvg2ui0tal13cctu31aftf618ak977n83jn9cd7gshkjocj6gos3hh1t3u0agbb3qn9uh3 --name AX61-1
    
# task:
  # name: Build
  # skip: $CIRRUS_BRANCH == 'ppp'
  # only_if: $CIRRUS_REPO_OWNER == 'My-builder'
  # timeout_in: 4h
  # persistent_worker:
    # labels:
      # name: AX61-1
    # isolation:
      # container:
        # image: snaxpsycho/snaxpsycho:test
        # cpu: 24
        # memory: 120G
        # volumes:
          # - /home/cirrus:/home/cirrus
          # - /home/cirrus/ccache:/home/cirrus/ccache
          # - /home/cirrus/.config:/home/cirrus/.config

# task:
  # name: "Snx-R"
  # timeout_in: 4h
  # container:
      # image: snaxpsycho/snaxpsycho:test
      # cpu: 8
      # memory: 32G
      # stateful: true
      # greedy: true
      # volumes:
          # - /home/cirrus:/home/cirrus
          # - /home/cirrus/ccache:/home/cirrus/ccache
          # - /home/cirrus/.config:/home/cirrus/.config
    
  notify_script:
    - set -e
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/notify.sh)
    
  tsync_script:
    - set -e
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/tsync.sh)
    
  sync_script:
    - set -e
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/sync.sh)    

  build_script:
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/build.sh)        

  ccache_stats_script:
    - set -e
    - export CCACHE_DIR=~/ccache/$rom_name/$device
    - ccache -s
  
  apps_up_script:
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/uploading_apps.sh)    
        
  upload_script:
    - bash <(curl -s https://raw.githubusercontent.com/My-builder/My-builder/$CIRRUS_BRANCH/snx/sfg_uploader.sh)    
    
  remove_script:
    - set -e
    - cd ~/$rom_name
    - rm -rf out/target/product/$device
    